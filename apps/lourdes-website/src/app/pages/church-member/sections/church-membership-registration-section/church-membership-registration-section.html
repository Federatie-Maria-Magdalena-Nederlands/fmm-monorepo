<!-- Registration Form Section -->
<section class="py-16 px-2 bg-gray-50 relative overflow-hidden">
  <app-abstract-background></app-abstract-background>

  <div class="max-w-4xl mx-auto relative z-10">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold text-gray-800 mb-4">
        Lidmaatschap Registratie
      </h2>
      <div class="h-1 w-20 bg-amber-600 mx-auto mb-4"></div>
      <p class="text-lg text-gray-700">
        Vul het registratieformulier in om lid te worden van onze parochie.
      </p>
    </div>

    <div class="bg-white rounded-2xl shadow-xl p-8">
      <!-- Progress Steps -->
      <div class="mb-8">
        <ul class="steps steps-horizontal w-full">
          @for(step of steps; track $index; let i = $index) {
          <li
            class="step"
            [class.step-warning]="i <= currentStep"
            [class.text-xs]="true"
          >
            {{ step }}
          </li>
          }
        </ul>
      </div>

      <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
        <!-- Step 1: Personal Information -->
        @if(currentStep === 0) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">
            Persoonlijke Gegevens
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-gray-700"
                  >Voornaam <span class="text-red-600">*</span></span
                >
              </label>
              <input
                type="text"
                formControlName="firstName"
                placeholder="Voer uw voornaam in"
                class="input input-bordered w-full"
                [class.input-error]="
                  isFieldInvalid('firstName')
                "
              />
              @if(isFieldInvalid('firstName')) {
              <label class="label">
                <span class="label-text-alt text-error">Voornaam is verplicht</span>
              </label>
              }
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-gray-700"
                  >Achternaam <span class="text-red-600">*</span></span
                >
              </label>
              <input
                type="text"
                formControlName="lastName"
                placeholder="Voer uw achternaam in"
                class="input input-bordered w-full"
                [class.input-error]="
                  isFieldInvalid('lastName')
                "
              />
              @if(isFieldInvalid('lastName')) {
              <label class="label">
                <span class="label-text-alt text-error"
                  >Achternaam is verplicht</span
                >
              </label>
              }
            </div>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Geslacht <span class="text-red-600">*</span></span
              >
            </label>
            <div class="flex gap-6">
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="gender"
                  value="Man"
                  class="radio radio-primary"
                />
                <span class="label-text">Man</span>
              </label>
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="gender"
                  value="Woman"
                  class="radio radio-primary"
                />
                <span class="label-text">Vrouw</span>
              </label>
            </div>
            @if(isFieldInvalid('gender')) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Selecteer uw geslacht</span
              >
            </label>
            }
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-gray-700"
                  >E-mailadres <span class="text-red-600">*</span></span
                >
              </label>
              <input
                type="email"
                formControlName="email"
                placeholder="uw.email@voorbeeld.nl"
                class="input input-bordered w-full"
                [class.input-error]="
                  isFieldInvalid('email')
                "
              />
              @if(isFieldInvalid('email')) {
              <label class="label">
                @if(registrationForm.get('email')?.hasError('required')) {
                <span class="label-text-alt text-error">
                  E-mailadres is verplicht
                </span>
                } @if(registrationForm.get('email')?.hasError('email')) {
                <span> Voer een geldig e-mailadres in </span>
                }
              </label>
              }
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-gray-700"
                  >Telefoonnummer <span class="text-red-600">*</span></span
                >
              </label>
              <input
                type="tel"
                formControlName="phoneNumber"
                placeholder="+31 6 1234 5678"
                class="input input-bordered w-full"
                [class.input-error]="
                  isFieldInvalid('phoneNumber')
                "
              />
              @if(isFieldInvalid('phoneNumber')) {
              <label class="label">
                <span class="label-text-alt text-error">
                  Telefoonnummer is verplicht
                </span>
              </label>
              }
            </div>
          </div>
        </div>
        }

        <!-- Step 2: Address Information -->
        @if(currentStep === 1) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">
            Adresgegevens
          </h3>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Adres (straatnaam, huisnummer en eventuele toevoegingen)
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="address"
              placeholder="Straatnaam, huisnummer"
              class="input input-bordered w-full"
              [class.input-error]="
                isFieldInvalid('address')
              "
            />
            @if(isFieldInvalid('address')) {
            <label class="label">
              <span class="label-text-alt text-error">Adres is verplicht</span>
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Postcode en plaats <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="postalCodeCity"
              placeholder="1234 AB Amsterdam"
              class="input input-bordered w-full"
              [class.input-error]="
                isFieldInvalid('postalCodeCity')
              "
            />
            @if(isFieldInvalid('postalCodeCity')) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Postcode en plaats zijn verplicht</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Bent u de hoofdbewoner van dit adres?
                <span class="text-red-600">*</span></span
              >
            </label>
            <div class="flex gap-6">
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="mainResident"
                  value="Yes"
                  class="radio radio-primary"
                />
                <span class="label-text">Ja</span>
              </label>
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="mainResident"
                  value="No"
                  class="radio radio-primary"
                />
                <span class="label-text">Nee</span>
              </label>
            </div>
            @if(isFieldInvalid('mainResident')) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Selecteer een optie</span
              >
            </label>
            }
          </div>
        </div>
        }

        <!-- Step 3: Religious Information -->
        @if(currentStep === 2) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">
            Religieuze Informatie
          </h3>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Bent u katholiek gedoopt?
                <span class="text-red-600">*</span></span
              >
            </label>
            <div class="flex gap-6">
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="baptizedCatholic"
                  value="Yes"
                  class="radio radio-primary"
                />
                <span class="label-text">Ja</span>
              </label>
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="baptizedCatholic"
                  value="No"
                  class="radio radio-primary"
                />
                <span class="label-text">Nee</span>
              </label>
            </div>
            @if(isFieldInvalid('baptizedCatholic')) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Selecteer een optie</span
              >
            </label>
            }
          </div>
        </div>
        }

        <!-- Step 4: Marital Information -->
        @if(currentStep === 3) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">
            Burgerlijke Staat
          </h3>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Burgerlijke staat <span class="text-red-600">*</span></span
              >
            </label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              @for(status of maritalStatuses; track status) {
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="maritalStatus"
                  [value]="status"
                  class="radio radio-primary"
                />
                <span class="label-text">{{ status }}</span>
              </label>
              }
            </div>
            @if(isFieldInvalid('maritalStatus')) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Selecteer uw burgerlijke staat</span
              >
            </label>
            }
          </div>

          @if(showMaritalDateFields()) {
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            @if(showWeddingDate()) {
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-gray-700"
                  >Datum huwelijk</span
                >
              </label>
              <input
                type="date"
                formControlName="weddingDate"
                class="input input-bordered w-full"
              />
            </div>
            } @if(showDissolutionDate()) {
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-gray-700"
                  >Datum ontbinding huwelijk</span
                >
              </label>
              <input
                type="date"
                formControlName="dissolutionDate"
                class="input input-bordered w-full"
              />
            </div>
            } @if(showWidowedSince()) {
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold text-gray-700"
                  >Weduwe/weduwnaar sinds</span
                >
              </label>
              <input
                type="date"
                formControlName="widowedSince"
                class="input input-bordered w-full"
              />
            </div>
            }
          </div>
          }
        </div>
        }

        <!-- Step 5: Spouse Information -->
        @if(currentStep === 4) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">
            Informatie Partner
          </h3>

          @if(requiresSpouseInfo()) {
          <div class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold text-gray-700"
                    >Achternaam echtgenoot/echtgenote</span
                  >
                </label>
                <input
                  type="text"
                  formControlName="spouseSurname"
                  placeholder="Voer achternaam in"
                  class="input input-bordered w-full"
                />
              </div>

              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold text-gray-700"
                    >Voornamen echtgenoot/echtgenote</span
                  >
                </label>
                <input
                  type="text"
                  formControlName="spouseFirstNames"
                  placeholder="Voer voornamen in"
                  class="input input-bordered w-full"
                />
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold text-gray-700"
                    >Geboortedatum echtgenoot/echtgenote</span
                  >
                </label>
                <input
                  type="date"
                  formControlName="spouseBirthDate"
                  class="input input-bordered w-full"
                />
              </div>

              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold text-gray-700"
                    >Geboorteplaats echtgenoot/echtgenote</span
                  >
                </label>
                <input
                  type="text"
                  formControlName="spouseBirthPlace"
                  placeholder="Voer geboorteplaats in"
                  class="input input-bordered w-full"
                />
              </div>
            </div>
          </div>
          } @else {
          <div class="alert alert-info">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              class="stroke-current shrink-0 w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            <span
              >Partnerinformatie niet vereist voor uw burgerlijke staat.</span
            >
          </div>
          }
        </div>
        }

        <!-- Step 6: Additional Information -->
        @if(currentStep === 5) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">
            Aanvullende Informatie
          </h3>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Ik wil ook graag de volgende familieleden registreren:</span
              >
            </label>
            <textarea
              formControlName="familyMembers"
              class="textarea w-full block textarea-bordered h-24"
              placeholder="Voer familieleden in die u wilt registreren..."
            ></textarea>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Stel hier uw vragen (niet verplicht)</span
              >
            </label>
            <textarea
              formControlName="questions"
              class="textarea w-full block textarea-bordered h-32"
              placeholder="Voer eventuele vragen of opmerkingen in..."
            ></textarea>
          </div>
        </div>
        }

        <!-- Success Message -->
        @if(submitSuccess) {
        <div class="alert alert-success mb-6">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="stroke-current shrink-0 h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span
            >Hartelijk dank voor uw registratie! We nemen binnenkort contact met u op met meer
            details.</span
          >
        </div>
        }

        <!-- Error Message -->
        @if(submitError) {
        <div class="alert alert-error mb-6">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="stroke-current shrink-0 h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span
            >Er is een fout opgetreden bij het verzenden van uw registratie. Probeer het opnieuw.</span
          >
        </div>
        }

        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-8">
          <button
            type="button"
            class="btn btn-outline"
            (click)="previousStep()"
            [disabled]="currentStep === 0"
          >
            Vorige
          </button>

          @if(currentStep < steps.length - 1) {
          <button
            type="button"
            class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
            (click)="nextStep()"
          >
            Volgende
          </button>
          } @else {
          <button
            type="submit"
            class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
            [disabled]="registrationForm.invalid || isSubmitting"
          >
            @if(isSubmitting) {
            <span class="loading loading-spinner"></span>
            Bezig met verzenden... } @else { Registratie Verzenden }
          </button>
          }
        </div>
      </form>
    </div>
  </div>
</section>
