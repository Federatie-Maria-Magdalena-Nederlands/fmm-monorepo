<!-- Anointing Form Section -->
<section class="py-16 px-2 bg-gray-50 relative overflow-hidden">
  <app-abstract-background></app-abstract-background>

  <div class="max-w-3xl mx-auto relative z-10">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold text-gray-800 mb-4">
        Ziekenzalving Aanvraagformulier
      </h2>
      <div class="h-1 w-20 bg-amber-600 mx-auto mb-4"></div>
      <p class="text-lg text-gray-700">
        Vul het onderstaande formulier in om de Ziekenzalving aan te vragen.
      </p>
    </div>

    <div class="bg-white rounded-2xl shadow-xl p-8">
      <!-- Stepper -->
      <ul class="steps steps-horizontal w-full mb-8">
        <li class="step" [ngClass]="{ 'step-warning': currentStep >= 1 }">
          Afzender
        </li>
        <li class="step" [ngClass]="{ 'step-warning': currentStep >= 2 }">
          Ontvanger
        </li>
        <li class="step" [ngClass]="{ 'step-warning': currentStep >= 3 }">
          Privacy
        </li>
      </ul>

      <form [formGroup]="anointingForm" (ngSubmit)="onSubmit()">
        <!-- Step 1: Sender Information -->
        @if(currentStep === 1) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">Afzender</h3>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Naam afzender <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="senderName"
              placeholder="Voer uw naam in"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('senderName')?.invalid &&
                anointingForm.get('senderName')?.touched
              "
            />
            @if(anointingForm.get('senderName')?.invalid &&
            anointingForm.get('senderName')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Sender's name is required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Sender's last name <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="senderLastName"
              placeholder="Enter your last name"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('senderLastName')?.invalid &&
                anointingForm.get('senderLastName')?.touched
              "
            />
            @if(anointingForm.get('senderLastName')?.invalid &&
            anointingForm.get('senderLastName')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Achternaam afzender is verplicht</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Mobiele telefoon afzender <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="tel"
              formControlName="senderPhone"
              placeholder="+31 6 1234 5678"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('senderPhone')?.invalid &&
                anointingForm.get('senderPhone')?.touched
              "
            />
            @if(anointingForm.get('senderPhone')?.invalid &&
            anointingForm.get('senderPhone')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Telefoonnummer afzender is verplicht</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >E-mailadres afzender
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="email"
              formControlName="senderEmail"
              placeholder="afzender.email@voorbeeld.nl"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('senderEmail')?.invalid &&
                anointingForm.get('senderEmail')?.touched
              "
            />
            @if(anointingForm.get('senderEmail')?.invalid &&
            anointingForm.get('senderEmail')?.touched) {
            <label class="label">
              @if(anointingForm.get('senderEmail')?.hasError('required')) {
              <span class="label-text-alt text-error">
                E-mailadres afzender is verplicht
              </span>
              } @else if(anointingForm.get('senderEmail')?.hasError('email')) {
              <span class="label-text-alt text-error">
                Voer een geldig e-mailadres in
              </span>
              }
            </label>
            }
          </div>

          <div class="bg-amber-50 p-4 rounded-lg mt-6">
            <p class="text-sm text-gray-700">
              Hieronder kunt u aangeven voor wie u een sacrament aanvraagt.
              Vul het formulier volledig in.
            </p>
          </div>
        </div>
        }

        <!-- Step 2: Recipient Information -->
        @if(currentStep === 2) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">
            Informatie Ontvanger
          </h3>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Naam van de persoon die het sacrament zal ontvangen
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientName"
              placeholder="Voer naam ontvanger in"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientName')?.invalid &&
                anointingForm.get('recipientName')?.touched
              "
            />
            @if(anointingForm.get('recipientName')?.invalid &&
            anointingForm.get('recipientName')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Naam ontvanger is verplicht</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Achternaam van de persoon die het sacrament zal ontvangen
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientSurname"
              placeholder="Voer achternaam ontvanger in"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientSurname')?.invalid &&
                anointingForm.get('recipientSurname')?.touched
              "
            />
            @if(anointingForm.get('recipientSurname')?.invalid &&
            anointingForm.get('recipientSurname')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Achternaam ontvanger is verplicht</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Voornaam van de persoon die het sacrament zal ontvangen
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientFirstName"
              placeholder="Voer voornaam ontvanger in"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientFirstName')?.invalid &&
                anointingForm.get('recipientFirstName')?.touched
              "
            />
            @if(anointingForm.get('recipientFirstName')?.invalid &&
            anointingForm.get('recipientFirstName')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Voornaam ontvanger is verplicht</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Adres van de persoon die het sacrament zal ontvangen
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientAddress"
              placeholder="Straatnaam en huisnummer"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientAddress')?.invalid &&
                anointingForm.get('recipientAddress')?.touched
              "
            />
            @if(anointingForm.get('recipientAddress')?.invalid &&
            anointingForm.get('recipientAddress')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Adres ontvanger is verplicht</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Postcode en woonplaats van de persoon die het sacrament zal ontvangen
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientPostalCity"
              placeholder="Postcode en plaats"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientPostalCity')?.invalid &&
                anointingForm.get('recipientPostalCity')?.touched
              "
            />
            @if(anointingForm.get('recipientPostalCity')?.invalid &&
            anointingForm.get('recipientPostalCity')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Postcode en plaats zijn verplicht</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Geboortedatum van de persoon die het sacrament zal ontvangen
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="date"
              formControlName="recipientDOB"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientDOB')?.invalid &&
                anointingForm.get('recipientDOB')?.touched
              "
            />
            @if(anointingForm.get('recipientDOB')?.invalid &&
            anointingForm.get('recipientDOB')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Geboortedatum ontvanger is verplicht</span
              >
            </label>
            }
          </div>
        </div>
        }

        <!-- Step 3: Privacy Statement -->
        @if(currentStep === 3) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">
            Privacyverklaring
          </h3>

          <div class="bg-amber-50 p-6 rounded-lg">
            <h4 class="font-bold text-lg text-gray-800 mb-3">
              Privacyverklaring Rooms-Katholieke Parochies en Algemene Verordening Bescherming Persoonsgegevens Parochies 2018
            </h4>
            <p class="text-sm text-gray-700 mb-3">
              In verband met de Algemene Verordening Gegevensbescherming (AVG) is een Privacyverklaring van toepassing en zijn bovengenoemde regelingen opgesteld. De Privacyverklaring en de Algemene Regeling zijn beschikbaar op de website en kunnen worden gedownload.
            </p>
            <p class="text-sm text-gray-700 mb-3">
              U ontvangt automatisch de Privacyverklaring als bijlage bij de kopiebevestiging.
            </p>
            <p class="text-sm text-gray-700 mb-3">
              Hieronder vindt u een aantal zaken (in verkorte, vereenvoudigde versies) die voor u belangrijk zijn en waarvoor wij (vooraf) uw toestemming vragen. Als u twijfelt over de uitleg in de verkorte versie, verwijzen wij u altijd naar de volledige Privacyverklaring en/of de Algemene Regeling.
            </p>
            <p class="text-sm text-gray-700 mb-3 font-semibold">
              Informatie Algemeen
            </p>
            <div class="mt-4 space-y-3">
              <div>
                <p class="font-semibold text-gray-800">Akkoord</p>
                <p class="text-sm text-gray-700">
                  De aanvrager(s) gaat/gaan akkoord met de bepalingen van de Privacyverklaring.
                </p>
              </div>
              <div>
                <p class="font-semibold text-gray-800">Niet akkoord</p>
                <p class="text-sm text-gray-700">
                  Als u niet akkoord gaat, kan de aanvraag niet worden verwerkt.
                </p>
              </div>
              <p class="text-sm text-gray-700">
                De informatie die u verstrekt, kan worden gebruikt voor parochiebeheer en zal hiervoor digitaal of op papier (in registers) worden opgeslagen. Een verzoek om deze gegevens in te zien is mogelijk. Het verzoeken om verwijdering van deze gegevens is over het algemeen niet mogelijk omdat dit noodzakelijk is voor het goed functioneren van een parochiekerk. De "Registratie- en Deregistratieprocedure (2013)" is van toepassing op verzoeken om uit de parochieregisters/administratie te worden verwijderd.
              </p>
              <p class="text-sm text-gray-700">
                Uw informatie wordt altijd vertrouwelijk behandeld en wordt nooit gedeeld met externe instellingen/instanties/derden zonder uw toestemming. Aan het einde van dit formulier worden u enkele vragen gesteld met betrekking tot de AVG. U kunt akkoord of niet akkoord gaan met de daar gestelde vragen, en uw verzoek zal worden verwerkt (ongeacht uw antwoord).
              </p>
            </div>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Gaat u akkoord met het privacybeleid van onze parochie?
                <span class="text-red-600">*</span></span
              >
            </label>
            <div class="space-y-3">
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="privacyAgreement"
                  value="agree"
                  class="radio radio-warning"
                />
                <span class="label-text">Ja! Ik ga akkoord</span>
              </label>
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="privacyAgreement"
                  value="disagree"
                  class="radio radio-warning"
                />
                <span class="label-text">Nee! Ik ga niet akkoord</span>
              </label>
            </div>
            @if(anointingForm.get('privacyAgreement')?.invalid &&
            anointingForm.get('privacyAgreement')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Ga akkoord met het privacybeleid om door te gaan</span
              >
            </label>
            }
          </div>
        </div>
        }

        <!-- Success Message -->
        @if(submitSuccess) {
        <div class="alert alert-success mb-6">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="stroke-current shrink-0 h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span
            >Hartelijk dank voor uw verzoek. We nemen snel contact met u op om de Ziekenzalving met zorg en aandacht voor te bereiden.</span
          >
        </div>
        }

        <!-- Error Message -->
        @if(submitError) {
        <div class="alert alert-error mb-6">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="stroke-current shrink-0 h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span
            >Er is een fout opgetreden bij het verzenden van uw verzoek. Probeer het opnieuw.</span
          >
        </div>
        }

        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-8">
          @if(currentStep > 1) {
          <button
            type="button"
            class="btn btn-outline btn-warning"
            (click)="previousStep()"
          >
            Vorige
          </button>
          } @else {
          <div></div>
          } @if(currentStep < 3) {
          <button
            type="button"
            class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
            (click)="nextStep()"
          >
            Volgende
          </button>
          } @else {
          <button
            type="submit"
            class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
            [disabled]="anointingForm.invalid || isSubmitting"
          >
            @if(isSubmitting) {
            <span class="loading loading-spinner"></span>
            Bezig met verzenden... } @else { Verzoek verzenden }
          </button>
          }
        </div>
      </form>
    </div>
  </div>
</section>
