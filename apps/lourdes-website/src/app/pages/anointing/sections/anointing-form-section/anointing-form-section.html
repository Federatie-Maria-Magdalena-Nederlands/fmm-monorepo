<!-- Anointing Form Section -->
<section class="py-16 px-2 bg-gray-50 relative overflow-hidden">
  <app-abstract-background></app-abstract-background>

  <div class="max-w-3xl mx-auto relative z-10">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold text-gray-800 mb-4">
        Anointing of the Sick Request Form
      </h2>
      <div class="h-1 w-20 bg-amber-600 mx-auto mb-4"></div>
      <p class="text-lg text-gray-700">
        Fill out the form below to request the Anointing of the Sick.
      </p>
    </div>

    <div class="bg-white rounded-2xl shadow-xl p-8">
      <!-- Stepper -->
      <ul class="steps steps-horizontal w-full mb-8">
        <li class="step" [ngClass]="{ 'step-warning': currentStep >= 1 }">
          Sender
        </li>
        <li class="step" [ngClass]="{ 'step-warning': currentStep >= 2 }">
          Recipient
        </li>
        <li class="step" [ngClass]="{ 'step-warning': currentStep >= 3 }">
          Privacy
        </li>
      </ul>

      <form [formGroup]="anointingForm" (ngSubmit)="onSubmit()">
        <!-- Step 1: Sender Information -->
        @if(currentStep === 1) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">Sender</h3>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Sender's name <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="senderName"
              placeholder="Enter your name"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('senderName')?.invalid &&
                anointingForm.get('senderName')?.touched
              "
            />
            @if(anointingForm.get('senderName')?.invalid &&
            anointingForm.get('senderName')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Sender's name is required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Sender's last name <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="senderLastName"
              placeholder="Enter your last name"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('senderLastName')?.invalid &&
                anointingForm.get('senderLastName')?.touched
              "
            />
            @if(anointingForm.get('senderLastName')?.invalid &&
            anointingForm.get('senderLastName')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Sender's last name is required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Mobile phone sender <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="tel"
              formControlName="senderPhone"
              placeholder="+31 6 1234 5678"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('senderPhone')?.invalid &&
                anointingForm.get('senderPhone')?.touched
              "
            />
            @if(anointingForm.get('senderPhone')?.invalid &&
            anointingForm.get('senderPhone')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Sender's phone number is required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Sender's email address
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="email"
              formControlName="senderEmail"
              placeholder="sender.email@example.com"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('senderEmail')?.invalid &&
                anointingForm.get('senderEmail')?.touched
              "
            />
            @if(anointingForm.get('senderEmail')?.invalid &&
            anointingForm.get('senderEmail')?.touched) {
            <label class="label">
              @if(anointingForm.get('senderEmail')?.hasError('required')) {
              <span class="label-text-alt text-error">
                Sender's email is required
              </span>
              } @else if(anointingForm.get('senderEmail')?.hasError('email')) {
              <span class="label-text-alt text-error">
                Please enter a valid email address
              </span>
              }
            </label>
            }
          </div>

          <div class="bg-amber-50 p-4 rounded-lg mt-6">
            <p class="text-sm text-gray-700">
              Below you can indicate for whom you are requesting a sacrament.
              Please complete the form in full.
            </p>
          </div>
        </div>
        }

        <!-- Step 2: Recipient Information -->
        @if(currentStep === 2) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">
            Recipient Information
          </h3>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Name of the person who will receive the sacrament
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientName"
              placeholder="Enter recipient's name"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientName')?.invalid &&
                anointingForm.get('recipientName')?.touched
              "
            />
            @if(anointingForm.get('recipientName')?.invalid &&
            anointingForm.get('recipientName')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Recipient's name is required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Surname of the person who will receive the sacrament
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientSurname"
              placeholder="Enter recipient's surname"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientSurname')?.invalid &&
                anointingForm.get('recipientSurname')?.touched
              "
            />
            @if(anointingForm.get('recipientSurname')?.invalid &&
            anointingForm.get('recipientSurname')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Recipient's surname is required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >First name of the person who is to receive the sacrament
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientFirstName"
              placeholder="Enter recipient's first name"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientFirstName')?.invalid &&
                anointingForm.get('recipientFirstName')?.touched
              "
            />
            @if(anointingForm.get('recipientFirstName')?.invalid &&
            anointingForm.get('recipientFirstName')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Recipient's first name is required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Address of the person who will receive the sacrament
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientAddress"
              placeholder="Street name and number"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientAddress')?.invalid &&
                anointingForm.get('recipientAddress')?.touched
              "
            />
            @if(anointingForm.get('recipientAddress')?.invalid &&
            anointingForm.get('recipientAddress')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Recipient's address is required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Postal code and city of the person who will receive the
                sacrament <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="text"
              formControlName="recipientPostalCity"
              placeholder="Zip code and city"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientPostalCity')?.invalid &&
                anointingForm.get('recipientPostalCity')?.touched
              "
            />
            @if(anointingForm.get('recipientPostalCity')?.invalid &&
            anointingForm.get('recipientPostalCity')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Postal code and city are required</span
              >
            </label>
            }
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Date of birth of the person to receive the sacrament
                <span class="text-red-600">*</span></span
              >
            </label>
            <input
              type="date"
              formControlName="recipientDOB"
              class="input input-bordered w-full"
              [class.input-error]="
                anointingForm.get('recipientDOB')?.invalid &&
                anointingForm.get('recipientDOB')?.touched
              "
            />
            @if(anointingForm.get('recipientDOB')?.invalid &&
            anointingForm.get('recipientDOB')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Recipient's date of birth is required</span
              >
            </label>
            }
          </div>
        </div>
        }

        <!-- Step 3: Privacy Statement -->
        @if(currentStep === 3) {
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">
            Privacy Statement
          </h3>

          <div class="bg-amber-50 p-6 rounded-lg">
            <h4 class="font-bold text-lg text-gray-800 mb-3">
              Privacy Statement Roman Catholic Parishes and General Regulations
              for the Protection of Personal Data Parishes 2018
            </h4>
            <p class="text-sm text-gray-700 mb-3">
              In connection with the General Data Protection Regulation (GDPR),
              a Privacy Statement applies and the above-mentioned regulations
              have been drawn up. The Privacy Statement and the General
              Regulations are available on the website and can be downloaded.
            </p>
            <p class="text-sm text-gray-700 mb-3">
              You will automatically receive the Privacy Statement as an
              attachment with the copy confirmation.
            </p>
            <p class="text-sm text-gray-700 mb-3">
              Below you will find a number of matters (in abbreviated,
              simplified versions) that are important to you and for which we
              request your permission (in advance). If you have any doubts about
              the explanation in the abbreviated version, we always refer you to
              the full Privacy Statement and/or the General Regulations.
            </p>
            <p class="text-sm text-gray-700 mb-3 font-semibold">
              Information General
            </p>
            <div class="mt-4 space-y-3">
              <div>
                <p class="font-semibold text-gray-800">Agreement</p>
                <p class="text-sm text-gray-700">
                  The applicant(s) agree(s) to the provisions of the Privacy
                  Statement.
                </p>
              </div>
              <div>
                <p class="font-semibold text-gray-800">Disagreement</p>
                <p class="text-sm text-gray-700">
                  If you do not agree, the application cannot be processed.
                </p>
              </div>
              <p class="text-sm text-gray-700">
                The information you provide may be used for parish
                administration and will be stored digitally or on paper (in
                registers) for this purpose. A request to view this data is
                possible. Requesting the deletion of this data is generally not
                possible because it is necessary for the proper functioning of a
                parish church. The "Registration and Deregistration Procedure
                (2013)" applies to requests to be removed from the parish
                registers/administration.
              </p>
              <p class="text-sm text-gray-700">
                Your information will always be treated confidentially and will
                never be shared with external institutions/agencies/third
                parties without your permission. At the end of this form, you
                will be asked a few questions regarding the GDPR. You can agree
                or disagree with the questions posed there, and your request
                will be processed (regardless of your answer).
              </p>
            </div>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold text-gray-700"
                >Do you agree with our parish's privacy policy?
                <span class="text-red-600">*</span></span
              >
            </label>
            <div class="space-y-3">
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="privacyAgreement"
                  value="agree"
                  class="radio radio-warning"
                />
                <span class="label-text">Yes! I agree</span>
              </label>
              <label class="cursor-pointer flex items-center gap-2">
                <input
                  type="radio"
                  formControlName="privacyAgreement"
                  value="disagree"
                  class="radio radio-warning"
                />
                <span class="label-text">No! I don't agree</span>
              </label>
            </div>
            @if(anointingForm.get('privacyAgreement')?.invalid &&
            anointingForm.get('privacyAgreement')?.touched) {
            <label class="label">
              <span class="label-text-alt text-error"
                >Please agree to privacy policy to continue</span
              >
            </label>
            }
          </div>
        </div>
        }

        <!-- Success Message -->
        @if(submitSuccess) {
        <div class="alert alert-success mb-6">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="stroke-current shrink-0 h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span
            >Thank you for your request. We will contact you quickly to prepare
            the Anointing of the Sick with care and attention.</span
          >
        </div>
        }

        <!-- Error Message -->
        @if(submitError) {
        <div class="alert alert-error mb-6">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="stroke-current shrink-0 h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span
            >There was an error submitting your request. Please try again.</span
          >
        </div>
        }

        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-8">
          @if(currentStep > 1) {
          <button
            type="button"
            class="btn btn-outline btn-warning"
            (click)="previousStep()"
          >
            Previous
          </button>
          } @else {
          <div></div>
          } @if(currentStep < 3) {
          <button
            type="button"
            class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
            (click)="nextStep()"
          >
            Next
          </button>
          } @else {
          <button
            type="submit"
            class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
            [disabled]="anointingForm.invalid || isSubmitting"
          >
            @if(isSubmitting) {
            <span class="loading loading-spinner"></span>
            Submitting... } @else { Submit Request }
          </button>
          }
        </div>
      </form>
    </div>
  </div>
</section>
