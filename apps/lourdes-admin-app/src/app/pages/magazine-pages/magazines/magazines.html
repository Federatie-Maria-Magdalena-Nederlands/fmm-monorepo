<div class="min-h-screen bg-gray-100 p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Magazines</h1>
        <p class="text-gray-600 mt-1">Manage magazine publications</p>
      </div>
      <button
        (click)="openCreateModal()"
        class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4v16m8-8H4"
          />
        </svg>
        Add Magazine
      </button>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">Search</span>
          </label>
          <input
            type="text"
            placeholder="Search by title..."
            class="input input-bordered w-full"
            [ngModel]="searchTerm()"
            (ngModelChange)="searchTerm.set($event); onSearchChange()"
          />
        </div>
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">Filter by Status</span>
          </label>
          <select
            class="select select-bordered w-full"
            [ngModel]="selectedStatus()"
            (ngModelChange)="selectedStatus.set($event); onStatusChange()"
          >
            @for(option of statusOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    @if(loading()) {
    <div class="flex justify-center items-center py-20">
      <div class="loading loading-spinner loading-lg text-amber-600"></div>
    </div>
    }

    <!-- Magazines Grid -->
    @if(!loading() && filteredMagazines().length > 0) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      @for(magazine of filteredMagazines(); track magazine.id) {
      <div class="card bg-white shadow-lg hover:shadow-xl transition-shadow">
        <div class="card-body">
          <div class="flex justify-between items-start mb-3">
            <h2 class="card-title text-lg">{{ magazine.title }}</h2>
            <div class="badge" [class.badge-success]="magazine.status === 'published'" [class.badge-warning]="magazine.status === 'draft'">
              {{ magazine.status }}
            </div>
          </div>

          <div class="space-y-2 text-sm text-gray-600">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <span>{{ formatDate(magazine.date) }}</span>
            </div>
            @if(magazine.fileName) {
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
              <span class="truncate">{{ magazine.fileName }}</span>
            </div>
            }
          </div>

          <div class="card-actions justify-end mt-4 gap-2">
            <button
              (click)="viewPDF(magazine.fileUrl)"
              class="btn btn-sm btn-outline btn-info"
              title="View PDF"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
            </button>
            <button
              (click)="toggleStatus(magazine)"
              class="btn btn-sm btn-outline"
              [class.btn-success]="magazine.status === 'draft'"
              [class.btn-warning]="magazine.status === 'published'"
              [title]="magazine.status === 'draft' ? 'Publish' : 'Unpublish'"
            >
              @if(magazine.status === 'draft') {
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              } @else {
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
              }
            </button>
            <button
              (click)="openEditModal(magazine)"
              class="btn btn-sm btn-outline btn-primary"
              title="Edit"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
            </button>
            <button
              (click)="deleteMagazine(magazine)"
              class="btn btn-sm btn-outline btn-error"
              title="Delete"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        </div>
      </div>
      }
    </div>
    }

    <!-- Empty State -->
    @if(!loading() && filteredMagazines().length === 0) {
    <div class="bg-white rounded-lg shadow-sm p-12 text-center">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-16 w-16 mx-auto text-gray-400 mb-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">No magazines found</h3>
      <p class="text-gray-500 mb-6">
        @if(searchTerm() || selectedStatus() !== 'all') {
        Try adjusting your filters
        } @else {
        Get started by creating your first magazine
        }
      </p>
      @if(!searchTerm() && selectedStatus() === 'all') {
      <button
        (click)="openCreateModal()"
        class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
      >
        Add Magazine
      </button>
      }
    </div>
    }
  </div>
</div>

<!-- Modal -->
@if(showModal()) {
<div class="modal modal-open">
  <div class="modal-box max-w-2xl">
    <h3 class="font-bold text-2xl mb-4">
      {{ editingMagazine() ? 'Edit Magazine' : 'Add New Magazine' }}
    </h3>
    
    <form [formGroup]="magazineForm" (ngSubmit)="saveMagazine()">
      <div class="space-y-4">
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">Title <span class="text-red-600">*</span></span>
          </label>
          <input
            type="text"
            formControlName="title"
            class="input input-bordered w-full"
            placeholder="Enter magazine title"
          />
          @if(magazineForm.get('title')?.invalid && magazineForm.get('title')?.touched) {
          <label class="label">
            <span class="label-text-alt text-error">Title is required</span>
          </label>
          }
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">Date <span class="text-red-600">*</span></span>
          </label>
          <input
            type="date"
            formControlName="date"
            class="input input-bordered w-full"
          />
          @if(magazineForm.get('date')?.invalid && magazineForm.get('date')?.touched) {
          <label class="label">
            <span class="label-text-alt text-error">Date is required</span>
          </label>
          }
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">PDF URL <span class="text-red-600">{{ editingMagazine() ? '' : '*' }}</span></span>
          </label>
          <input
            type="url"
            formControlName="fileUrl"
            class="input input-bordered w-full"
            placeholder="https://example.com/magazine.pdf"
          />
          <label class="label">
            <span class="label-text-alt text-gray-500">Provide a direct link to the PDF file</span>
          </label>
        </div>

        <div class="divider">OR</div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">Upload PDF File</span>
          </label>
          <input
            type="file"
            accept=".pdf"
            (change)="onFileSelected($event)"
            class="file-input file-input-bordered w-full"
          />
          @if(editingMagazine() && editingMagazine()?.fileName) {
          <label class="label">
            <span class="label-text-alt text-info">Current file: {{ editingMagazine()?.fileName }}</span>
          </label>
          }
          @if(selectedFile()) {
          <label class="label">
            <span class="label-text-alt text-success">Selected: {{ selectedFile()?.name }}</span>
          </label>
          }
          <label class="label">
            <span class="label-text-alt text-gray-500">Upload will override the URL above</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">Status <span class="text-red-600">*</span></span>
          </label>
          <select formControlName="status" class="select select-bordered w-full">
            <option value="draft">Draft</option>
            <option value="published">Published</option>
          </select>
        </div>
      </div>

      <div class="modal-action">
        <button
          type="button"
          class="btn btn-ghost"
          (click)="closeModal()"
          [disabled]="saving()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn bg-amber-600 hover:bg-amber-700 text-white border-none"
          [disabled]="magazineForm.invalid || saving() || (!editingMagazine() && !selectedFile() && !magazineForm.get('fileUrl')?.value?.trim())"
        >
          @if(saving()) {
          <span class="loading loading-spinner loading-sm"></span>
          Saving...
          } @else {
          {{ editingMagazine() ? 'Update' : 'Create' }}
          }
        </button>
      </div>
    </form>
  </div>
</div>
}
